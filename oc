# How systemReserved CPU and Memory Protect Node Stability

## What is systemReserved?

`systemReserved` is a kubelet configuration that reserves a specific amount of CPU and memory **only for the node's system processes** (like kubelet, CRI-O/containerd, OS services, logging agents).

- These reserved resources are **not available** for Kubernetes pods.
- It ensures that even under heavy application load, the system services will always have the CPU and memory they need to function.

---

## Why systemReserved Is Critical

If systemReserved is **not** configured:
- Kubernetes schedules pods based on nearly the **entire node capacity**.
- During heavy load, **critical system services** may **starve** for resources.
- This leads to node instability: kubelet crashes, container runtime crashes, networking failures, and unpredictable pod evictions.

By configuring systemReserved:
- A **portion of CPU and memory is guaranteed** for system operations.
- **Pods are scheduled** only against the **remaining allocatable resources**.
- This prevents **resource starvation** and ensures **long-term node health**.

---

## How systemReserved Works

When kubelet starts:
- It **subtracts** the systemReserved resources from the total node capacity.
- Only the **remaining allocatable resources** are **advertised to the Kubernetes scheduler**.
- Pods **cannot** consume the reserved resources.

**Node Resource Formula:**
```
Node Allocatable = Node Capacity - systemReserved - kubeReserved - evictionThresholds
```

(Where `kubeReserved` is usually reserved for Kubernetes internal components, while `systemReserved` is for OS + kubelet/containerd.)


### Example:
| Node | CPU (cores) | Memory (GiB) |
|:-----|:-----------|:------------|
| Total Capacity | 16 cores | 61 GiB |
| systemReserved | 800m CPU | 1.5 GiB memory |
| Final Allocatable | ~15.2 cores | ~59.5 GiB memory |

Result: **Only 15.2 CPU and 59.5GiB are available for pods.**

Scheduler ensures that pods do not consume the system's reserved resources.

---

## What Happens Without systemReserved?

- Critical services like kubelet, CRI-O, sshd, auditd could **fail** under load.
- Nodes become **NotReady** or tainted with conditions like `MemoryPressure`, `DiskPressure`.
- Pods experience random **evictions** or **deployment failures**.
- Cluster-wide stability risks increase.


---

## Summary

✅ `systemReserved` guarantees stability by **protecting OS and critical services** on every node.  
✅ Pods are **only scheduled** against safe, reduced allocatable resources.  
✅ It is **mandatory for production OpenShift clusters** to avoid unexpected node crashes under high workload.

Always calculate `systemReserved` based on node size and workload profile.
