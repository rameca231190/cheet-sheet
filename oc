---
- name: Ensure amazon-efs-utils is installed
  hosts: all
  become: yes
  tasks:
    - name: Check if amazon-efs-utils is installed
      shell: "rpm -q amazon-efs-utils || dpkg -l | grep amazon-efs-utils"
      register: efs_check
      ignore_errors: yes

    - name: Install amazon-efs-utils if not present (RHEL/CentOS/Amazon Linux)
      yum:
        name: amazon-efs-utils
        state: present
      when: efs_check.rc != 0
      tags: efs-utils

    - name: Install amazon-efs-utils if not present (Debian/Ubuntu)
      apt:
        name: amazon-efs-utils
        state: present
      when: efs_check.rc != 0
      tags: efs-utils
